<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ราคาทองคำและการแปลงค่าเงิน</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .price, .converted-price {
            font-size: 1.5em;
            color: #333;
        }
        select {
            margin-top: 20px;
            padding: 10px;
            font-size: 1em;
        }
        canvas {
            max-width: 600px;
            margin: 20px auto;
        }
        .info {
            margin: 20px;
        }
        .error {
            color: red;
            font-size: 1.2em;
        }
    </style>
</head>
<body>
    <h1>ราคาทองคำปัจจุบัน</h1>
    <div id="gold-price" class="price">กำลังโหลด...</div>

    <select id="currency-selector">
        <option value="USD">ดอลลาร์สหรัฐ ($)</option>
        <option value="THB" selected>เงินบาท (฿)</option>
    </select>

    
    <div class="info">
        <h2>ข้อมูลเพิ่มเติม:</h2>
        <p id="prev-close-price">ราคาปิดก่อนหน้า: --</p>
        <p id="price">ราคาปัจจุบัน: --</p>
        <p id="change">การเปลี่ยนแปลง: --</p>
        <p id="change-percentage">การเปลี่ยนแปลง (%) : --</p>
        <p id="price-gram">ราคา/กรัม (24K): --</p>
    </div>

    <div id="error-message" class="error"></div>

    <script>
        let goldPriceUSD = null;
        let exchangeRate = null;

        async function fetchGoldPrices() {
            const myHeaders = new Headers();
            myHeaders.append("x-access-token", "goldapi-7j50jsm06u4prn-io");
            myHeaders.append("Content-Type", "application/json");

            const requestOptions = {
                method: 'GET',
                headers: myHeaders,
                redirect: 'follow'
            };

            try {
                const response = await fetch("https://www.goldapi.io/api/XAU/USD", requestOptions);
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const data = await response.json();
                
                // ประมวลผลข้อมูล
                goldPriceUSD = data.price; // เก็บราคาทองคำใน USD
                updateDisplay('THB'); // เรียกใช้เพื่ออัพเดทราคาเริ่มต้นเป็น THB
              
            } catch (error) {
                console.error('ข้อผิดพลาดในการดึงข้อมูลราคาทองคำ:', error);
                document.getElementById('gold-price').textContent = 'ไม่สามารถโหลดราคาทองคำได้.';
                document.getElementById('error-message').textContent = `ข้อผิดพลาด: ${error.message}`;
            }
        }

        async function fetchExchangeRate() {
            try {
                const response = await fetch('https://api.exchangerate-api.com/v4/latest/USD'); // API อัตราแลกเปลี่ยน
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const data = await response.json();
                exchangeRate = data.rates.THB; // อัตราแลกเปลี่ยน USD เป็น THB
                return exchangeRate;
            } catch (error) {
                console.error('ข้อผิดพลาดในการดึงอัตราแลกเปลี่ยน:', error);
                document.getElementById('error-message').textContent = `ข้อผิดพลาดในการดึงอัตราแลกเปลี่ยน: ${error.message}`;
                return null;
            }
        }

        async function updateDisplay(currency) {
            if (goldPriceUSD === null) {
                return;
            }

            let displayPrice = goldPriceUSD;
            if (currency === 'THB') {
                if (exchangeRate === null) {
                    exchangeRate = await fetchExchangeRate();
                    if (exchangeRate === null) {
                        document.getElementById('gold-price').textContent = 'ไม่สามารถโหลดอัตราแลกเปลี่ยนได้.';
                        return;
                    }
                }
                displayPrice = goldPriceUSD * exchangeRate;
            }
            const formattedPrice = displayPrice.toFixed(2);
            document.getElementById('gold-price').textContent = `ราคาทองคำปัจจุบัน: ${currency === 'USD' ? '$' : '฿'}${formattedPrice} ต่อ ออนซ์`;
            updateAdditionalInfoDisplay(currency);
        }

        function updateAdditionalInfoDisplay(currency) {
            if (goldPriceUSD === null || exchangeRate === null) {
                return;
            }
            const formatPrice = (price) => (currency === 'USD' ? price : price * exchangeRate).toFixed(2);

            document.getElementById('prev-close-price').textContent = `ราคาปิดก่อนหน้า: ${currency === 'USD' ? '$' : '฿'}${formatPrice(2484.745)}`;
            document.getElementById('price').textContent = `ราคาปัจจุบัน: ${currency === 'USD' ? '$' : '฿'}${formatPrice(goldPriceUSD)}`;
            document.getElementById('change').textContent = `การเปลี่ยนแปลง: ${currency === 'USD' ? '$' : '฿'}${formatPrice(31.21)}`;
            document.getElementById('change-percentage').textContent = `การเปลี่ยนแปลง (%) : ${1.26}%`;
            document.getElementById('price-gram').textContent = `ราคา/กรัม (24K): ${currency === 'USD' ? '$' : '฿'}${formatPrice(80.8898)}`;
        }

       

        document.getElementById('currency-selector').addEventListener('change', async (event) => {
            await updateDisplay(event.target.value);
        });

        // เรียกใช้ฟังก์ชันในการดึงข้อมูลราคาทองคำเมื่อโหลดหน้าเว็บ
        fetchGoldPrices();
    </script>
</body>
</html>
